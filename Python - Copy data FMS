from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
import time
import gspread
from oauth2client.service_account import ServiceAccountCredentials

# Đường dẫn đến ChromeDriver mà bạn đã tải về
chrome_driver_path = "C:/Users/kiet.trantuan/Desktop/chromedriver-win64/chromedriver.exe"

# Đường dẫn đến profile Chrome mà bạn muốn sử dụng
chrome_profile_path = r'C:/Users/kiet.trantuan/AppData/Local/Google/Chrome/User Data/Profile 1'

# Tạo tùy chọn cho Chrome
chrome_options = Options()

# Chỉ định đường dẫn đến profile Chrome đã lưu
chrome_options.add_argument(f"user-data-dir={chrome_profile_path}")

# Tạo service cho ChromeDriver
service = Service(executable_path=chrome_driver_path)

# Khởi động trình duyệt Chrome với các tùy chọn đã chỉ định
driver = webdriver.Chrome(service=service, options=chrome_options)

# Mở trang web
driver.get("https://spx.shopee.vn/#/dashboard/facility-soc/historical-data")

# Đợi trang web tải xong
time.sleep(10)  # Điều chỉnh thời gian này nếu cần

# Lấy dữ liệu từ bảng
table_element = driver.find_element(By.CSS_SELECTOR, "#mgmt-dashboard-content > div > div > div.index_pc_wrapper__u1bI2 > div > div > div:nth-child(2) > div > div.med-card-content.border > div.med-collapse > div.med-collapse-content")

rows = table_element.find_elements(By.TAG_NAME, "tr")
data = []
for row in rows:
    cols = row.find_elements(By.TAG_NAME, "td")
    data.append([col.text for col in cols])

# Đóng trình duyệt
driver.quit()

# Cấu hình Google Sheets API
scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
creds = ServiceAccountCredentials.from_json_keyfile_name('C:/Users/kiet.trantuan/Downloads/fifth-mechanism-425310-s9-48dab9776369.json', scope)
client = gspread.authorize(creds)

# Mở Google Sheets
sheet = client.open_by_url("https://docs.google.com/spreadsheets/d/1AbAiQDiQNIUm9fNKuxNm-GAOKsEXE5aOiiJicz5ML3U/edit?usp=sharing")
worksheet = sheet.get_worksheet(0)

# Xóa dữ liệu cũ trong Sheet (nếu cần)
worksheet.clear()

# Cập nhật dữ liệu mới vào Google Sheets
for i, row in enumerate(data):
    worksheet.insert_row(row, i + 1)

print("Dữ liệu đã được cập nhật thành công.")
